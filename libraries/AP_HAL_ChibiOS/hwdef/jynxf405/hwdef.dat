MCU STM32F4xx STM32F405xx

HAL_CHIBIOS_ARCH_F405 1

APJ_BOARD_ID 1500

OSCILLATOR_HZ 24000000

STM32_ST_USE_TIMER 5

FLASH_SIZE_KB 1024
FLASH_RESERVE_START_KB 64

I2C_ORDER I2C2

SERIAL_ORDER OTG1 USART1 USART6

#PB5 LED_BLUE OUTPUT LOW GPIO(1)
#define HAL_GPIO_A_LED_PIN 1
#define HAL_GPIO_B_LED_PIN 2

#PB8 CAN1_RX CAN1
#PB9 CAN1_TX CAN1

#PB5 CAN2_RX CAN2
#PB6 CAN2_TX CAN2

PC1 BAT_CURR_SENS ADC1 SCALE(1)
PC2 BAT_VOLT_SENS ADC1 SCALE(1)

PB0 TIM1_CH2N TIM1 PWM(1) GPIO(50)
PB1 TIM1_CH3N TIM1 PWM(2) GPIO(51)
PA3 TIM2_CH4  TIM2 PWM(3) GPIO(52)
PA2 TIM2_CH3  TIM2 PWM(4) GPIO(53)
#PA1 TIM2_CH2  TIM2 PWM(5) GPIO(54)
#PA0 TIM2_CH1  TIM2 PWM(6) GPIO(55)
#PC8 TIM8_CH3  TIM8 PWM(7) GPIO(56)
#PC9 TIM8_CH4  TIM8 PWM(8) GPIO(59)

PA4 ICM42688_CS CS
PA5 SPI1_SCK SPI1
PA6 SPI1_MISO SPI1
PA7 SPI1_MOSI SPI1
PC4 ICM42688_DRDY INPUT

PC6 USART6_TX USART6
PC7 USART6_RX USART6

PB7 USART1_RX USART1
PB6 USART1_TX USART1

PA13 JTMS-SWDIO SWD
PA14 JTCK-SWCLK SWD

#edited
PC12 SPI3_MOSI SPI3
PC11 SPI3_MISO SPI3
PC10 SPI3_SCK SPI3
PA15 Flash_CS CS   #edited
PB3 DPS310_CS CS

PB15 SPI2_MOSI SPI2
PB14 SPI2_MISO SPI2
PB13 SPI2_SCK SPI2
PB12 SDCARD_CS CS


#PC3 VDD_5V_SENS ADC1
PA11 OTG_FS_DM OTG1
PA12 OTG_FS_DP OTG1
#PC5 USB_SENSE ADC1
PC5 VBUS INPUT OPENDRAIN

PB8 TIM4_CH3 TIM4 RCININT PULLDOWN LOW

#IMU Invensense SPI:mpu6000 ROTATION_YAW_180

#SPIDEV mpu6000  SPI1 DEVID1 MPU6000_CS MODE3 2*MHZ 8*MHZ
SPIDEV icm42688  SPI1 DEVID1  ICM42688_CS  MODE3  2*MHZ  8*MHZ
SPIDEV sdcard   SPI2 DEVID2 SDCARD_CS MODE0 400*KHZ 25*MHZ
SPIDEV spiflash   SPI3 DEVID3 Flash_CS MODE3 32*MHZ 32*MHZ
SPIDEV dps310   SPI3 DEVID3 DPS310_CS MODE3 5*MHZ 5*MHZ

IMU Invensensev3 SPI:icm42688 ROTATION_YAW_180

BARO DPS280  SPI:dps310

PB10 I2C2_SCL I2C2 PULLUP
PB11 I2C2_SDA I2C2 PULLUP

#BARO MS56XX I2C:0:0x76
#BARO MS56XX I2C:0:0x77

define HAL_BARO_ALLOW_INIT_NO_BARO

#CAD1 logic low, CAD0 logic low (b00001100) [internal mag]
COMPASS AK8963 I2C:0:0x0c ROTATION_NONE

#CAD1 logic high, CAD0 logic low (b00001110) [external mag]
#COMPASS AK8963 I2C:0:0x0e ROTATION_NONE

define HAL_COMPASS_AK8963_ENABLED 1


# no built-in compass, but probe the i2c bus for all possible
# external compass types
define ALLOW_ARM_NO_COMPASS
define HAL_PROBE_EXTERNAL_I2C_COMPASSES
define HAL_I2C_INTERNAL_MASK 0
define HAL_COMPASS_AUTO_ROT_DEFAULT 2
define HAL_I2C_ENABLED

define STORAGE_FLASH_PAGE 1
define HAL_STORAGE_SIZE 15360

define HAL_OS_FATFS_IO 1
define HAL_BOARD_LOG_DIRECTORY "/APM/LOGS"
define HAL_BOARD_TERRAIN_DIRECTORY "/APM/TERRAIN"

define HAL_BATT_VOLT_PIN 12
define HAL_BATT_CURR_PIN 11
define HAL_BATT_VOLT_SCALE 11
define HAL_BATT_CURR_SCALE 18.2

define BOARD_PWM_COUNT_DEFAULT 8

define HAL_BATTMON_SMBUS_ENABLE 0
define HAL_BATTMON_FUEL_ENABLE 0

define HAL_PARACHUTE_ENABLED 0
define HAL_SPRAYER_ENABLED 0

#env DEFAULT_PARAMETERS Tools/Frame_params/jynxf405.param


# minimal drivers to reduce flash usage
include ../include/minimize_fpv_osd.inc

#define HAL_ENABLE_DRONECAN_DRIVERS 1



#for smbus based batteries
undef AP_BATTERY_SMBUS_ENABLED
#define AP_BATTERY_SMBUS_ENABLED 1




undef HAL_MOUNT_ENABLED
undef AP_MOUNT_BACKEND_DEFUALT_ENABLED
undef HAL_MOUNT_CADDX_ENABLED
undef AP_CAMERA_MOUNT_ENABLED

define AP_CAMERA_MOUNT_ENABLED 1
define HAL_MOUNT_ENABLED 1
define AP_MOUNT_BACKEND_DEFUALT_ENABLED 0
define HAL_MOUNT_CADDX_ENABLED 1